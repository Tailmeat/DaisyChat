<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅</title>

    <link rel="stylesheet" href="main.css">
</head>

<body>

    <div class="background"></div>

    <div id="chatContent" class="chatContent">
        <div class="line">
            <div class="profile"><img src="Daisy.png"></div>
            <span class="chat">Hello my friend!</span>
        </div>
    </div>
    
    <input placeholder="메세지 보내기..." class="chat" id="input">
    <div id="send"><ion-icon name="paper-plane-outline"></ion-icon></div>

    <!-- <div class="copyright">ⓒ 2022. TaiLmEaT All rights reserved.</div> -->

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script type="module">
        import { Configuration, OpenAIApi } from "https://cdn.skypack.dev/openai"

        const configuration = new Configuration({
            apiKey: "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",
        });

        const openai = new OpenAIApi(configuration);
        var chattings = '';

        function sendChat() {
            if (document.getElementById('input').value != "") {
                var template =
                    `<div class="line">
                <span class="chat myChat">${document.querySelector("#input").value}</span>
                </div>`
                document.querySelector(".chatContent").insertAdjacentHTML("beforeend", template)

                openai.createCompletion({
                    model: "text-davinci-003",
                    prompt: `${chattings}You: ${document.querySelector("#input").value}\Daisy: `,
                    temperature: 0.5,
                    max_tokens: 60,
                    top_p: 1,
                    frequency_penalty: 0.5,
                    presence_penalty: 0,
                    stop: "\nYou",
                }).then((result) => {
                    console.log(result.data)
                    console.log(result.data.choices[0].text)
                    var template =
                        `<div class="line">
                        <div class="profile"><img src="Daisy.png"></div>
                    <span class="chat">${result.data.choices[0].text}</span>
                </div>`
                    document.querySelector(".chatContent").insertAdjacentHTML("beforeend", template)
                    document.getElementById('chatContent').scrollTop = document.getElementById('chatContent').scrollHeight;
                    chattings += `You: ${document.querySelector("#input").value}\nDaisy: ${result.data.choices[0].text}\n`
                })
                document.getElementById("input").value = "";

                document.getElementById('chatContent').scrollTop = document.getElementById('chatContent').scrollHeight;
            }
        }

        window.addEventListener("keydown", e => {
            if (e.key == "Enter") {
                sendChat();
            }
        })

        document.querySelector("#send").addEventListener("click", function () {
            sendChat();
        })
    </script>
</body>

</html>